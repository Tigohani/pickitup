<p id="notice"><%= notice %></p>

<h1>Current Tasks</h1>
<br>

<div class="search">
  <%= form_with scope: :tasks, method: :get, local: true do |f| %>
    <%= f.label :category_id %>:&nbsp;
    <%= f.collection_select :main_category_id, MainCategory.all, :id, :name, prompt: true %>
    <%= f.submit :search, class: 'search_btn' %>
  <% end %>
</div>

<% if @tasks.count > 0 %>
  <table class="center">
    <thead>
      <tr>
        <th>User</th>
        <th>Category</th>
        <th>Title</th>
        <th>Image</th>      
        <th>Delivery addr</th>
        <th>Pickup addr</th>
        <th>Price</th>
        <th>Pickup time</th>
        <th>Status</th>
        <th>Driver</th>
        <th colspan="3">Menus</th>
      </tr>
    </thead>

    <tbody>
      <% @tasks.each do |task| %>
        <tr>
          <td><%= task.user.profile.first_name %></td>
          <td><%= task.main_category.name %></td>
          <td><%= task.title %></td>
          <td>
            <% if task.image.present? %>
              <%= image_tag task.image_url(:thumb) %>
            <% else %>
              <%= image_tag "noimage.jpeg", class: "thumbimage" %>
            <% end%>
          </td>        
          <td><%= task.delivery_address %></td>
          <td><%= task.pickup_address %></td>
          <td><%= task.price_in_dollars %></td>
          <td><%= task.pickup_time %></td>
          <td><%= task.status %></td>
          <td>
            <% if task.status == "accepted" %>
              <%= task.driver.profile.first_name %>
            <% end %>
          </td>
          <td><%= link_to 'Show', task %></td>
          <td><%= link_to 'Edit', edit_task_path(task) %></td>
          <td><%= link_to 'Destroy', task, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <h2 class="nodata">No Tasks posted!</h2>
<% end %>

<br>
<div class="links">
  <%= link_to 'New Task', new_task_path, class: "link_btn" %>
</div>
